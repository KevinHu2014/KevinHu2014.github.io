<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: reactnative | Hsiangyu's Blog]]></title>
  <link href="https://hsiangyu.com/blog/categories/reactnative/atom.xml" rel="self"/>
  <link href="https://hsiangyu.com/"/>
  <updated>2018-01-06T21:13:30+08:00</updated>
  <id>https://hsiangyu.com/</id>
  <author>
    <name><![CDATA[Hsiangyu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ViroReact AR åˆé«”é©—]]></title>
    <link href="https://hsiangyu.com/blog/2018/01/05/ar/"/>
    <updated>2018-01-05T22:46:31+08:00</updated>
    <id>https://hsiangyu.com/blog/2018/01/05/ar</id>
    <content type="html"><![CDATA[<h2>å‰è¨€</h2>

<p>æœ€è¿‘å‰›å¥½æ‹¿åˆ°å¯¦é©—å®¤æ–°æ¡è³¼çš„æ‰‹æ©Ÿï¼Œä¸€éš»æ˜¯ASUS å‡ºçš„Zenfone ARï¼Œå¦ä¸€éš»æ˜¯Apple å‡ºçš„iPhone Xã€‚å‰é™£å­åœ¨React Native Communityçš„ç¤¾ç¾¤æœ‰surveyåˆ°viromedia é€™å®¶å…¬å¸åšçš„ARå¥—ä»¶ï¼Œå°±èŠ±äº†æ™‚é–“ç ”ç©¶äº†ä¸€ä¸‹ã€‚</p>

<h2>æ­£æ–‡</h2>

<p>æœƒæƒ³è¦ç©ARï¼Œæ˜¯å› ç‚ºä¹‹å‰çœ‹åˆ°Snapchat&rsquo;s æ–°çš„AR åŠŸèƒ½</p>

<iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Fmashableclickclickclick%2Fvideos%2F10155694012049705%2F&show_text=0&width=476" width="476" height="476" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allowFullScreen="true"></iframe>


<p>æƒ³ç‚ºå…¬å¸çš„å°ˆæ¡ˆä¹ŸåŠ å…¥ARçš„åŠŸèƒ½ã€‚ç”±æ–¼å…¬å¸çš„å°ˆæ¡ˆæ˜¯ç”¨React Nativeä¾†é–‹ç™¼çš„ï¼Œå‰›å¥½viromediaæœ‰æ¨å‡ºViroReactï¼Œé€éViroReactå¯ä»¥å»å‘¼å« iOSçš„ ARkitæˆ–æ˜¯ Androidçš„ ArCoreï¼Œä¸¦é€éåŒä¸€ä»½ç¨‹å¼ç¢¼çš„ç‰¹æ€§ä¾†å¿«é€Ÿåœ¨é›™å¹³å°ä¸Šé–‹ç™¼ARçš„æ‡‰ç”¨ã€‚</p>

<p>æ¥ä¸‹ä¾†å°±å¿«é€Ÿå¸¶ä¸€ä¸‹å®‰è£æ•™å­¸</p>

<p>æ‰€éœ€è¨­å‚™</p>

<p>AR (iOS)</p>

<ol>
<li><p>iOS è£ç½®è‡³å°‘è¦æ˜¯ A9 chip è€Œä¸” é‹è¡Œ iOS 11</p></li>
<li><p>OSX çš„é›»è…¦</p></li>
</ol>


<p>AR (Android)</p>

<ol>
<li>æ”¯æ´ARCore çš„æ‰‹æ©Ÿ</li>
</ol>


<!--more-->


<p>é¦–å…ˆè¦ç¢ºä¿ä½ çš„é›»è…¦æ˜¯æœ‰React Nativeçš„ç’°å¢ƒ
<code>
npm install -g react-native-cli
</code></p>

<p>å†ä¾†æ˜¯å®‰è£ VIROREACT COMMAND LINE INTERFACE
<code>
npm install -g react-viro-cli
</code>
æ¥ä¸‹ä¾†æ˜¯åˆå§‹ä¸€å€‹ VIROREACTçš„å°ˆæ¡ˆ
<code>
react-viro init ViroSample --verbose
</code>
ç„¶å¾Œè¦å»ä¸‹App å•†åº—ä¸‹è¼‰ç¨‹å¼</p>

<p>iOS</p>

<p><a href="https://itunes.apple.com/us/app/viro-media/id1163100576?mt=8">Viro Media App</a></p>

<p>Android</p>

<p><a href="https://play.google.com/store/apps/details?id=com.viromedia.viromedia">Viro Media App</a></p>

<p>æ¥è‘—æ‰“é–‹å‰›å‰›åˆå§‹åŒ–çš„å°ˆæ¡ˆï¼Œæ‰¾åˆ°<code>App.js</code>ï¼Œå°‡<code>API_KEY_HERE</code>ç½®æ›æˆä½ çš„API Keyã€‚å¦‚æœé‚„æ²’æœ‰APIçš„è©±ï¼Œè«‹å»ç¶²ç«™<a href="https://viromedia.com/signup">è¨»å†Š</a>ï¼Œè¨»å†Šå®Œå¾Œä»–æœƒä»¥Emailçš„å½¢å¼å°‡API keyå¯„çµ¦ä½ ã€‚</p>

<p>å†ä¾†æ˜¯åœ¨terminal å•Ÿå‹• package server
<code>
npm start
</code>
é€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç”¨å»åŸ·è¡Œ<code>react-native run-android</code>æˆ–<code>react-native run-ios</code>ä¹Ÿä¸ç”¨å»Xcodeé‚£é‚Šé–‹å•Ÿå°ˆæ¡ˆã€‚
å› ç‚ºå¾ˆé‡è¦ï¼Œæ‰€ä»¥è¦ç‰¹åˆ¥æé†’xDï¼Œè·Ÿä»¥å¾€çš„å¥—ä»¶ä½¿ç”¨æµç¨‹éå¸¸ä¸ä¸€æ¨£ã€‚</p>

<p>æœ€å¾Œå°±è¦ä¾†æ¸¬è©¦æˆ‘å€‘çš„<code>TESTBED APP</code>äº†</p>

<ol>
<li>åœ¨ä½ çš„ iOSæˆ–æ˜¯ Andoroidè£ç½®ä¸Šé–‹å•Ÿ Viro Media App</li>
<li>é»æ“Šå·¦å´çš„ Menuï¼Œç„¶å¾Œé»æ“Š"Enter Testbed"</li>
<li>æ‰¾åˆ°ä½ çš„ngrok url <code>https://xxxxxx.ngrok.io</code>ï¼Œä»–æœƒé¡¯ç¤ºåœ¨ä½ çš„npm start çš„é‚£å€‹terminal é é¢ï¼Œè¼¸å…¥å¾Œå°±æŒ‰GO</li>
<li>æœƒæœ‰å…©å€‹æŒ‰éˆ•å¯ä»¥é¸ï¼Œä¸€å€‹æ˜¯ ARï¼Œå¦ä¸€å€‹æ˜¯ VRã€‚é€™è£¡å°±é¸æ“‡AR</li>
</ol>


<p>ä»¥ä¸Šæ˜¯åƒè€ƒå®˜ç¶² <a href="https://docs.viromedia.com/docs/quick-start">Quick Start</a>çš„ç¿»è­¯å’ŒåŠ å…¥ä¸€äº›è‡ªå·±è¦ºå¾—è©²æ³¨æ„çš„åœ°æ–¹</p>

<p>Hello World çš„ç•«é¢å¤§æ¦‚å¦‚ä¸‹</p>

<p><img src="https://s10.postimg.org/b6o1a3yu1/IMG_0004.png" alt="" /></p>

<p>å¦‚æœæœ‰èˆˆè¶£ç¹¼çºŒç ”ç©¶çš„è©±å¯ä»¥åƒè€ƒ<a href="https://docs.viromedia.com/v2.2.0/docs/tutorial-ar">é€£çµ</a>ï¼Œèµ°å®Œå¾Œçš„finalå¤§æ¦‚å¦‚ä¸‹åœ–</p>

<p><img src="https://s10.postimg.org/7aape1ljd/IMG_0005.png" alt="" /></p>

<p><img src="https://s10.postimg.org/gsf1rt9g9/IMG_0006.png" alt="" /></p>

<h2>å¾Œè¨˜</h2>

<p>å¯¦é©—å®¤çš„Zenfone AR ä¸¦ä¸æ”¯æ´ï¼Œç›®å‰æ”¯æ´ARCoreçš„æ‰‹æ©Ÿå…¶å¯¦ç›¸ç•¶ç¨€å°‘ï¼ˆPixel, Pixel XL, Pixel 2, Pixel 2 XL, and Samsung S8.ï¼‰ï¼Œåœ¨æœªä¾†æ‡‰è©²æœƒæ…¢æ…¢æ”¯æ´æ›´å¤šçš„ Androidæ‰‹æ©Ÿã€‚
é‡å°ç›®å‰é€™å€‹å•é¡Œï¼ŒGithubä¸Šæœ‰é–‹ç™¼è€…æ˜¯é€éä¿®æ”¹Android Libraryä¾†ç¹é ARCore device checkï¼ˆ<a href="https://github.com/tomthecarrot/arcore-for-all">é€£çµ</a>ï¼‰ï¼Œä¸éæˆ‘ç›®å‰è©¦äº†æˆ‘æ‰‹é‚Šçš„æ‰‹æ©Ÿéƒ½æ²’æœ‰æˆåŠŸï¼Œå¯èƒ½çœŸçš„å°±è¦å†ç­‰ç­‰å§ï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PermissionsAndroid å‘]]></title>
    <link href="https://hsiangyu.com/blog/2017/09/04/react-native-permissionsandroid/"/>
    <updated>2017-09-04T17:50:59+08:00</updated>
    <id>https://hsiangyu.com/blog/2017/09/04/react-native-permissionsandroid</id>
    <content type="html"><![CDATA[<h1>Andoird 6.0 PermissionsAndroid å‘</h1>

<h2>å‰è¨€</h2>

<p>æœ€è¿‘é–‹ç™¼å…¬å¸çš„RNå°ˆæ¡ˆé‡åˆ°ä¸€å€‹å•é¡Œï¼Œæ˜æ˜åœ¨ <code>AndroidManifest.xml</code>æœ‰åŠ å…¥äº†
<code>
  &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
</code>
ï¼Œä½†åœ¨åŸ·è¡Œçš„æ™‚å€™é‚„æ˜¯æœƒå™´errorï¼Œæ¥è‘—å°±ç›´æ¥crashã€‚
<a href="https://postimg.org/image/9cbhtb0yd/"><img src="https://s26.postimg.org/tjoxllyft/21706759_1435564026520969_1452689658_o.png" alt="error-message" /></a></p>

<p>åˆ°æ‡‰ç”¨ç¨‹å¼çš„è¨­å®šå»çœ‹ï¼Œæœƒç™¼ç¾<strong>ä½ç½®</strong>çš„æˆæ¬Šä¸¦æ²’æœ‰è¢«é–‹å•Ÿï¼Œå¯æ˜¯æˆ‘è¨˜å¾—åœ¨<code>Andoird 5.0</code>ä¹‹å‰æ˜¯æ²’æœ‰é€™å€‹å•é¡Œçš„ï¼Œæœ€è¿‘æŠŠé–‹ç™¼æ©Ÿå‡ç´šåˆ°<code>Andoird 7.0</code>æ‰é‡åˆ°ã€‚</p>

<h2>æ­£æ–‡</h2>

<p>æ·±å…¥ç ”ç©¶å¾Œï¼Œæ‰ç™¼ç¾åœ¨<code>Andoird 6.0 (API 23)</code> ä¹‹å¾Œï¼Œå±éšªæ¬Šé™éƒ½éœ€è¦å‹•æ…‹å–å¾—ä½¿ç”¨è€…æˆæ¬Šã€‚è²¼å¿ƒçš„æ˜¯React Native æœ‰æä¾› <code>PermissionsAndroid</code> çš„ API ä¾†ä¾›ä½ ä½¿ç”¨ğŸ‘ğŸ‘</p>

<!--more-->


<p>é‚£ <code>PermissionsAndroid</code> æœ‰æä¾›ä¸‰å€‹ Methods:</p>

<h3>check (permission)</h3>

<p>æª¢æŸ¥æ¬Šé™</p>

<blockquote><p>Returns a promise resolving to a boolean value as to whether the specified permissions has been granted</p></blockquote>

<p>ç¯„ä¾‹ï¼š</p>

<pre><code class="javascript">
//æª¢æŸ¥ Loaction Permission ç‚ºä¾‹

async checkLocationPermission() {
    try {
      const granted = await PermissionsAndroid.check(
        PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION
      );
      if (granted === PermissionsAndroid.RESULTS.GRANTED) {
        console.log('å®¢å®˜å·²æˆäºˆä½ç½®çš„æ¬Šé™');
      } else {
        console.log('å®¢å®˜å°šæœªæˆäºˆä½ç½®æ¬Šé™')
      }
    } catch (err) {
      console.warn(err);
    }
  }
</code></pre>

<h3>request(permission, rationale?)</h3>

<p>è«‹æ±‚æ¬Šé™</p>

<blockquote><p>Prompts the user to enable a permission and returns a promise resolving to a string value indicating whether the user allowed or denied the request</p>

<p>If the optional rationale argument is included (which is an object with a title and message), this function checks with the OS whether it is necessary to show a dialog explaining why the permission is needed (<a href="https://developer.android.com/training/permissions/requesting.html#explain">https://developer.android.com/training/permissions/requesting.html#explain</a>) and then shows the system permission dialog</p></blockquote>

<p>rationaleçš„åƒæ•¸å¯æœ‰å¯ç„¡ï¼Œå¦‚æœæ²’æœ‰çš„è©±ï¼Œè·³çª—ï¼ˆdialogï¼‰å°±æœƒé¡¯ç¤ºé è¨­çš„è¨Šæ¯ã€‚</p>

<p>ç¯„ä¾‹ï¼š</p>

<pre><code class="javascript">//è«‹æ±‚ Camera Permission ç‚ºä¾‹

async requestCameraPermission() {
  try {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.CAMERA,
      {
        'title': 'Cool Photo App Camera Permission',
        'message': 'Cool Photo App needs access to your camera ' +
                   'so you can take awesome pictures.'
      }
    )
    if (granted === PermissionsAndroid.RESULTS.GRANTED) {
      console.log("You can use the camera")
    } else {
      console.log("Camera permission denied")
    }
  } catch (err) {
    console.warn(err)
  }
}
</code></pre>

<h3>requestMultiple(permissions)</h3>

<p>è«‹æ±‚å¤šå€‹æ¬Šé™</p>

<blockquote><p>Prompts the user to enable multiple permissions in the same dialog and returns an object with the permissions as keys and strings as values indicating whether the user allowed or denied the request</p></blockquote>

<h3>ä½¿ç”¨æµç¨‹</h3>

<p>æˆ‘çš„ä½¿ç”¨æµç¨‹æœƒå…ˆå»check ä½¿ç”¨è€…æ˜¯å¦å·²æˆæ¬Šæ­¤æ¬Šé™ï¼Œå¦‚æœæ²’æœ‰çš„è©±å‰‡å‘ä½¿ç”¨è€…ç™¼å‡ºè«‹æ±‚ã€‚</p>

<p>ç¯„ä¾‹ï¼š</p>

<pre><code class="javascript">
componentWillMount() {
  this.checkLocationPermission();
}


// æª¢æŸ¥ä½¿ç”¨è€…çš„ä½ç½®æˆæ¬Š
async checkLocationPermission() {
  try {
    const granted = await PermissionsAndroid.check(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION
    );
    if (granted === PermissionsAndroid.RESULTS.GRANTED || granted === true) {
      // æœ‰æ‹¿åˆ°æˆæ¬Šæ‰å»è¦ GPS
      this.askForGPS();
    } else {
      // æ²’æœ‰æˆæ¬Šçš„è©±å°±å»å‘ä½¿ç”¨è€…è«‹æ±‚
      this.requestLocationPermission();
    }
  } catch (err) {
    console.warn(err);
  }
}

async askForGPS() {
  //å¦‚æœä½¿ç”¨è€…æ²’æœ‰é–‹å•ŸGPSçš„è©±ï¼Œè¦å»è·Ÿä»–è¦
  LocationServicesDialogBox.checkLocationServicesIsEnabled({
      message: '&lt;h2&gt;Use Location ?&lt;/h2&gt;This app wants to change your device settings:&lt;br/&gt;&lt;br/&gt;Use GPS, Wi-Fi, and cell network for location&lt;br/&gt;&lt;br/&gt;',
      ok: 'YES',
      cancel: 'NO'
  }).then((success) =&gt; {
      //å¦‚æœä½¿ç”¨è€…æœ‰é–‹å•Ÿgpsæ‰å»æŠ“ä»–çš„ä½ç½®
      navigator.geolocation.getCurrentPosition(
        (position) =&gt; {
          console.log(position.coords.latitude);
          console.log(position.coords.longitude);
        },
        (error) =&gt; { console.log(error); },
        { enableHighAccuracy: false, timeout: 20000, maximumAge: 1000 },
      );
      console.log(success); // success =&gt; "enabled"
  }).catch((error) =&gt; {
      this.setState({ alertVisible: true });
      console.log(error.message); // error.message =&gt; "disabled"
  });
}

async requestLocationPermission() {
  try {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION
    );
    if (granted === PermissionsAndroid.RESULTS.GRANTED  || granted === true) {
      console.log('ç¾åœ¨ä½ ç²å¾—GPSæ¬Šé™äº†');
      this.askForGPS();
    } else {
      console.log('ç”¨æˆ¶ä¸ç†ä½ ');
    }
  } catch (err) {
    console.warn(err);
  }
}
</code></pre>

<p>é€™é‚Šè£œå……èªªæ˜ä¸€ä¸‹</p>

<pre><code class="javascript">
  if (granted === PermissionsAndroid.RESULTS.GRANTED  || granted === true){}
</code></pre>

<p>é€™é‚Šè¦å¦å¤–å¯«<code>granted === true</code> æ˜¯å› ç‚ºSDK å°æ–¼23 çš„è©±æ˜¯å›å‚³ true</p>

<blockquote><p>On devices before SDK version 23, the permissions are automatically granted if they appear in the manifest, so check and request should always be true.</p></blockquote>

<h3>å®åš€</h3>

<p>åœ¨æ¸¬è©¦é€™å¡Šçš„æ™‚å€™è¦è¨˜å¾—ï¼Œé™¤äº†æ¸¬ SDK >= 23çš„ç‰ˆæœ¬ä¹‹å¤–ï¼Œ SDK &lt; 23 çš„ä¹Ÿè¦è¨˜å¾—æ¸¬è©¦ã€‚</p>

<h2>åƒè€ƒè³‡æ–™</h2>

<p><a href="https://facebook.github.io/react-native/docs/permissionsandroid.html">https://facebook.github.io/react-native/docs/permissionsandroid.html</a></p>
]]></content>
  </entry>
  
</feed>
